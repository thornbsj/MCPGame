import { enemy } from "./enemy";
import { Player } from "./Player";
import { NPC } from "./NPCs";
import { Skill } from "./Skill";
import { Battle } from "./Battle";
import express from "express";

const expressApp = express();
expressApp.use(express.json());

const CON_skill = new Skill("CON测试1","测试CON","CON")
const DEX_skill = new Skill("DEX测试1","测试DEX","DEX")
const INT_skill = new Skill("INT测试1","测试INT","INT")
const badass_skill = new Skill("badass测试1","测试badass","badass")
const my_profile = 'data:image/png;base64,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'
const ourside_profile = 'data:image/png;base64,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'
const enemyside_profile = 'data:image/png;base64,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'
const player = new Player(
    "测试玩家1",
    60,//hp
    30,//mp
    10,//CON
    10,//DEX
    10,//INT
    100,//morality
    100,//EGO
    1,//level
    0,//exp
    100,//gold
    CON_skill,my_profile,[CON_skill]
)

const npc1 = new NPC("测试队友1",30,30,10,10,10,100,100,1,0,DEX_skill,ourside_profile,"",false,false,"","",[DEX_skill]);
const npc2 = new NPC("测试队友2",30,30,10,10,10,100,100,1,0,INT_skill,ourside_profile,"",false,false,"","",[INT_skill]);

player.add_partyMembers(npc1)
player.add_partyMembers(npc2)

const enemy1 = new enemy("测试敌人1",enemyside_profile,"regular",30,30,9,9,9,1,CON_skill,new Map(),10);
const enemy2 = new enemy("测试敌人2",enemyside_profile,"elite",30,30,10,10,10,1,INT_skill,new Map(),10);
const enemy3 = new enemy("测试敌人3",enemyside_profile,"badass",30,30,10,10,10,1,badass_skill,new Map([["测试物品","测试描述"]]),10);

const test_battle = new Battle(player,[enemy1,enemy2,enemy3])
test_battle.battle()
console.log(test_battle.logs)
expressApp.get('/game/BattleBtn', async (req, res) => {
  try {
    res.json(JSON.stringify(test_battle.logs));
  } catch (error) {
    console.error("错误：", error);
  }
});
expressApp.listen(3000,"localhost", (error) => {
  if (error) {
    console.error('Failed to start server:', error);
    process.exit(1);
  }
  console.log(`MCP Stateless Streamable HTTP Server listening on port`);
});