import { string } from "zod";

interface AppConfig {
    // GM的MCP
    add_world_info: string;
    update_relation:string;
    change_world: string;
    add_NPC: string;
    battle: string;
    changeStatus:string;
    addSkill:string;
    gainItem:string;
    minusItem:string;
    add_quest:string;
    buildPrompt:string;
    end:string;
    // NPC的MCP
    add_character_design:string;
    Betrayal:string;
    add_to_potential_member:string;
    summary:string;
    decide_to_talk:string;
    summary_to_Player:string;
    // 参数量小的MCP
    refresh_enemys:string;
    text2Img:string;
    // 初始化世界观
    main_world:string;
    world1:string;
    world2:string;
    world3:string;
    world4:string;
    final_world:string;
    //结局相关
    morality_threshold:number;
    EGO_threshold:number;
    ending_with_high_EGO_and_high_morality:string;
    ending_with_low_EGO_and_low_morality:string;
    ending_with_high_EGO_and_low_morality:string;
    ending_with_low_EGO_and_high_morality:string;
  }
  
const defaultConfig: AppConfig = {
  add_world_info:`**函数名**: \`add_world_info\`  
  **功能描述**:  
  当游戏中出现以下情况时调用此函数：  
  ✅**记录世界动态** - 发生影响世界观的重大事件（如关键势力关系变更、社会体系变化等世界观要素更新）。

  **参数说明**:  
  | 参数   | 类型                 | 说明                                                                 |
  |--------|----------------------|----------------------------------------------------------------------|
  | \`world\`| string               | **目标世界唯一标识符**<br>(如\`"steampunk_city"\`, \`"elf_kingdom"\`)    |
  | \`data\` | string               | **世界数据**：- 动态事件：关键事件的自然语言描述 |`,
  update_relation:`**函数名**: \`update_relation\`  
  **功能描述**:  
  当以下情况发生时调用此函数：  
  1. **势力关系质变** - 派系间结盟/宣战/中立协议  
  2. **冲突事件升级** - 发生改变势力平衡的关键事件  
  ⚠️**关键约束**:  
  → 必须在目标世界初始化后调用  
  → 紧张度变化值(\`tensionDelta\`)范围：-100~+100  

  **参数说明**:  
  | 参数               | 类型                                      | 说明                                                                 |
  |--------------------|-------------------------------------------|----------------------------------------------------------------------|
  | \`world\`            | string                                    | **目标世界标识符** (必须与\`add_world_info\`注册一致)                  |
  | \`factionA\`         | string                                    | **势力A名称** (如\`"steam_guild"\`, \`"elf_royal_family"\`)              |
  | \`factionB\`         | string                                    | **势力B名称** (如\`"slum_rebels"\`, \`"dwarf_miners_union"\`)            |
  | \`attitude\`         | \`"hostile"\` \| \`"neutral"\` \| \`"friendly"\` \| \`"allied"\` | **新关系状态**：<br>- \`hostile\`：敌对(红色)<br>- \`neutral\`：中立(黄色)<br>- \`friendly\`：友好(绿色)<br>- \`allied\`：同盟(金色) |
  | \`eventDescription\` | string                                    | **关系变更事件描述** (20字内简明原因)                                |
  | \`tensionDelta\`     | number (可选，默认0)                      | **紧张度变化值**：<br>- 正值：冲突加剧(🔥)<br>- 负值：局势缓和(🕊️)    |`,
  change_world:`**函数名**: \`change_world\`  
  **功能描述**:  
  **在玩家完成当前世界的主线任务并满足过渡条件时，由系统自动调用此函数**。此函数用于将玩家传送至下一个预定义的世界，重置环境状态，并携带上一个世界的经历摘要。穿越过程不可逆，且必须遵循固定的世界序列。
  
  **调用时机**:  
  ✅ **仅当以下条件同时满足时调用**：
  1. 当前世界的主线任务已完成（如解决核心冲突、达成结局）。
  2. 游戏叙述符合该世界设定中描述的【过渡方式】（如能量爆发、信物共振等）。
  3. 目标世界已定义在游戏序列中。
  4. *重要：*如果调用了change_world函数，就必须跟着调用refresh_enemys函数
  
  ❌ **禁止由玩家主动调用**，也不得用于非主线任务相关的场景切换。
  
  **关键约束**:  
  ⚠️ **世界序列固定**：  
  - 世界传送必须遵循严格顺序：**奇点侦测站 → 齿轮 → 源法 → 混元 → 黯蚀 → 终焉**。
  - 函数参数 \`world\` 必须为序列中的下一个世界名称。
  
  **参数说明**:  
  | 参数 | 类型 | 描述 |
  |------|------|------|
  | \`world\` | 字符串 | **目标世界名称**，必须与预设序列完全匹配。<br>可选值：\`"齿轮"\`、\`"源法"\`、\`"混元"\`、\`"黯蚀"\`、\`"终焉"\`。<br>示例：从“奇点侦测站”完成后，\`world\` 应为 \`"齿轮"\`。 |
  | \`summary\` | 字符串 | **上一个世界的经历摘要**（≤200字符）。<br>需提炼：<br>- 完成的核心任务<br>- 关键抉择与后果<br>- 获得的重大能力/物品<br>- 对后续世界可能的影响<br>示例："在奇点侦测站解开了AI叛乱真相，获得神经接口强化，与哨兵AI建立了脆弱同盟。" |
  
  **过渡叙事指引**:  
  调用此函数后，AI应：
  1. 结合当前世界的【过渡方式】描述穿越过程
  2. 简要回顾 \`summary\` 中的关键经历
  3. 确保叙述连贯性，保持玩家身份连续性
  4. 在新世界苏醒后，环境状态完全重置，但保留核心经历记忆
  
  **摘要生成原则**:  
  - 精炼核心叙事，省略琐碎细节
  - 聚焦对角色发展和后续剧情有长期影响的事件
  - 保持客观事实描述，避免主观评价`,
  add_NPC:`**函数名**: \`add_NPC\`  
  **功能描述**:  
  在游戏中创建一个深度融入当前世界观的非玩家角色（NPC）。该NPC不仅具备独特的个人背景，还需深刻理解所在世界的核心冲突、社会结构和文化背景，使其成为世界的有机组成部分。
  
  **关键约束**:  
  ⚠️ **必须遵守以下核心规则**：
  1. **名称唯一性**：NPC的 \`name\` 必须全局唯一，禁止与任何已存在NPC重名
  2. **属性平衡**：  
      - \`CON + DEX + INT\` 之和 = 玩家队伍三属性平均值的**向上取整**  
      - \`level\` = 玩家队伍平均等级的**向上取整**  
  3. **属性依赖**：\`dependent\` 必须是 "CON"/"DEX"/"INT" 中的一个
  4. **物品限制**：每个NPC只能携带一个物品（\`item\`），需与角色设定相符
  5. **技能描述规范**：  
      - \`skill_desc\` **不得包含任何数值描述**（如"造成INT×2伤害"）
      - 仅描述技能的效果、外观和表现形式
      - \`skill\` 名称必须与 \`skill_desc\` 描述的内容配套一致
  
  **参数说明**:  
  - \`name\` (字符串): **NPC的全新唯一名称**（如"莉娜·暗影之歌"），创建前需验证是否已存在
  - \`CON/DEX/INT\` (整数): 体质/敏捷/智力属性，需满足上述平衡公式
  - \`level\` (整数): 等级，需满足上述平衡公式  
  - \`character_design\` (字符串): **角色的深度设定**，必须包含以下要素：
    ✅ **个人背景**：出身、经历、动机（如"曾是皇家法师，因实验事故失去记忆"）
    ✅ **性格特质**：核心性格特征（如"多疑但善良，对魔法既渴望又恐惧"）
    ✅ **世界观认知**：对当前世界核心冲突的理解（如"深知齿轮世界的能源危机将引发阶层战争"）
    ✅ **社会关系**：与世界中主要势力的关联（如"与源法世界的流亡法师有秘密联系"）
    ✅ **当前目标**：在世界背景下的个人追求（如"寻找稳定异界通道的方法"）
  
  - \`skill\` (字符串): **技能名称**（如"火焰箭"）
  - \`skill_desc\` (字符串): **技能效果描述**（需避免数值，如"召唤一支燃烧的火焰箭矢射向敌人"）
  - \`dependent\` (字符串): **技能依赖的属性**（必须为"CON"/"DEX"/"INT"）
  - \`item\` (字符串): **携带物品名称**（如"破损的护身符"）
  - \`item_description\` (字符串): **物品详细描述**（需体现世界观关联，如"刻有源法世界符文的银制护身符，似乎能感应齿轮世界的能量波动"）
  
  **世界观整合要求**:  
  在生成 \`character_design\` 时，必须深度结合当前世界的以下要素：
  - **核心冲突**：如资源争夺、意识形态对立、生存危机等
  - **社会结构**：权力阶层、职业分工、文化习俗
  - **地理环境**：地形特征、气候条件、特殊区域
  - **关键技术/魔法**：世界的核心运作机制
  - **重大历史事件**：影响世界现状的过去事件
  
  **示例对比**:
  ❌ **过于简略**：
  "一个流浪法师，会火球术"
  
  ✅ **深度融入世界观**：
  "莉娜·暗影之歌，曾是在齿轮世界边缘活动的能源走私者。三年前源法世界的魔法泄露事件让她获得了操控火焰的能力，但也因此被两大世界的执法者追捕。她深知齿轮世界的能源垄断与源法世界的魔法扩张即将引发全面冲突，目前躲在混元世界的交界处，试图找到利用两界能量共存的方法。性格谨慎多疑，但对真正理解她处境的人会展现出罕见的忠诚。"
  
  **技能描述示例**:
  ✅ **正确**（无数值）：
  - "召唤一支燃烧的火焰箭矢"
  - "制造一个小型防护屏障"  
  - "快速移动到阴影位置"
  
  ❌ **错误**（含数值）：
  - "造成INT×2的伤害"
  - "提升DEX点闪避率"
  - "恢复CON×3的生命值"`,

  battle:`**函数名**: \`battle\`  
  **功能描述**:  
  当玩家**主动发起**与现存NPC或队友的战斗时调用此函数。此函数仅用于处理玩家与**已注册角色**的冲突，不可用于系统生成的敌人。
  
  **关键约束**:  
  ⚠️**目标选择规则**:  
  - \`npc_name\` 数组必须包含 **至少一个有效目标**  
  - 每个目标必须是以下之一：  
    通过 \`add_NPC\` 创建的 **现存NPC**
    玩家队伍中的 **注册队友**（特殊NPC类型）
    **绝对禁止** 包含系统自动生成的敌人（如野怪/副本怪物）  
  
  **系统边界**:  
  - 当玩家试图攻击 **非注册敌人**（如随机遭遇的怪物）时：  
    → ❌**禁止调用本函数**
    → ⚠️必须提示玩家："请使用右侧战斗按钮攻击系统敌人"
  
  **参数说明**:  
  - \`npc_name\` (字符串数组): **要攻击的目标列表**，需满足：  
    - 名称必须 **精确匹配** 现存NPC/队友名（大小写敏感）  
    - 示例：\`["兽人战士格罗姆", "精灵弓箭手莉亚"]\`  
  
  **战斗触发条件**:  
  ✅仅在玩家表达明确战斗意图时调用，例如：
  - "我要攻击那个守卫" → 当守卫是注册NPC  
  - "干掉队友" → 队友在数组中
  - "伏击商队三人组" → 多个注册NPC`,
  changeStatus:`**函数名**: \`changeStatus\`  
  **功能描述**:  
  当玩家、NPC或队友的**核心状态属性发生数值变动**时调用此函数。用于精确调整特定角色的游戏数值属性，包括生命值、能力值或道德指标等。**此外，获得装备时也应调用此函数直接增加对应属性**。
  
  **调用时机**:
  - ✅ 角色属性因事件发生增减（如受伤恢复、能力提升、道德抉择）
  - ✅ 需要修改注册角色的永久性状态值
  - ✅ 玩家自身状态发生变化（非临时效果）
  - ✅ **获得装备时**（如武器、防具、饰品），直接增加相关属性（如CON、DEX、INT）
  
  **关键约束**:  
  ⚠️ **目标对象** (\`npc\`):  
  - 必须是 \`"self"\`（玩家自身）或 **现存NPC/队友的精确名称**  
  - 禁止使用未注册的NPC名称
  
  **状态类型** (\`name\`):  
  - 必须为以下**预定义属性**之一（严格匹配）：
    \`hp\`（生命值） | \`mp\`（魔法值） | \`CON\`（体质）
    \`DEX\`（感知） | \`INT\`（智力） | \`EGO\`（自我认知）
    \`morality\`（道德值） | \`exp\`（经验值） | \`gold\`（金钱）
  
  - 其中，\`EGO\`|\`morality\`|\`gold\`三项只对玩家有用，只有玩家才需要修改这三项。
  
  **数值操作** (\`value\`):
  - 必须为**整数**（正数表示增加，负数表示减少）
  - 示例：\`+20\`（恢复生命）, \`-5\`（降低道德）
  
  **装备处理规则**:  
  - 当获得装备时，应根据装备类型调用本函数增加对应属性（如获得剑增加CON，获得袍增加INT）
  - 装备提供的属性提升是永久的，因此直接修改基础属性
  - 无需调用 \`gainItem\` 记录装备本身
  
  **禁止调用场景**:  
  ❌ 临时状态效果（如中毒、祝福等时限效果）  
  ❌ 非预定义属性的变更（如声望、称号等）`,
  addSkill:`**函数名**: \`addSkill\`  
  **功能描述**:  
  为指定角色**定义或更新一个永久性技能**，该技能的效果将动态关联到角色的基础属性。仅在角色通过以下方式**永久获得**新能力时调用：
  - 升级解锁的技能
  - 完成训练/学习获得的技能
  - 剧情事件赋予的固有能力
  - 装备/物品附带的常驻技能
  
  **调用时机示例**:
  ✅ 玩家通过卷轴学会"火球术"  
  ✅ NPC升级解锁专属技能  
  ✅ 完成师徒事件获得传承技能  
  ❌ **不要用于**临时增益效果（如药水效果）
  ❌ **不要调用**角色已经有了同名的技能
  ❌ **不要调用**角色没有这一技能，但是玩家却输入让其使用该技能
  
  **参数规范**:  
  | 参数 | 类型 | 要求 | 示例 |
  |------|------|------|------|
  | \`npc\` | 字符串 | **目标角色标识**：<br>- \`"self"\` = 玩家自身<br>- \`NPC名称\` = **当前世界**的现存NPC或队友（大小写敏感） | \`"self"\`<br>\`"矮人铁匠布隆"\` |
  | \`name\` | 字符串 | **技能唯一名称**<br>（≤20字符，同一角色不可重复） | \`"雷霆重击"\` |
  | \`description\` | 字符串 | **技能效果描述**（禁止数值描述）<br>需包含：<br>- 技能表现形式<br>- 效果性质<br>- 使用条件/限制<br>**禁止包含**：伤害值、百分比、具体数值 | \`"挥舞武器发出雷霆一击，震慑敌人"\` |
  | \`dependent\` | 字符串 | **必须为\`CON\`/\`DEX\`/\`INT\`**<br>定义技能效果关联的基础属性 | \`"CON"\` |
  
  **关键约束**:  
  ⚠️ **描述规范**:  
  - \`description\` **不得包含任何数值描述**（如"造成×2伤害"、"恢复30HP"）
  - 仅描述技能的表现形式、效果性质和视觉特征
  - \`name\` 必须与 \`description\` 描述的内容配套一致
  
  **描述示例**:
  ✅ **正确**（无数值）：
  - "召唤火焰环绕武器，增强攻击威力"
  - "快速移动到阴影位置，避开敌人视线"
  - "创造一个小型防护屏障抵挡攻击"
  
  ❌ **错误**（含数值）：
  - "造成INT×2的伤害"
  - "提升30%闪避率"
  - "恢复CON×3的生命值"`,

  gainItem:`**函数名**: \`gainItem\`  
  **功能描述**:  
  当玩家或NPC**获得新物品**时调用此函数。用于记录物品的核心信息，适用于拾取、购买、赠送等获取场景。但注意：**装备类物品不在此函数处理范围**。
  
  **调用时机**:  
  ✅ 角色通过以下方式获得**非装备类物品**：
  - 拾取消耗品（如药水、卷轴）
  - 获得任务物品（如钥匙、信件）
  - 购买或获得材料（如矿石、草药）
  
  ❌ **禁止用于装备类物品**（如武器、防具、饰品），这些应直接调用 \`changeStatus\` 增加属性
  
  **参数说明**:  
  | 参数 | 类型 | 要求 | 示例 |
  |------|------|------|------|
  | \`npc\` | 字符串 | **物品获得者**：<br>- \`"self"\` = 玩家自身<br>- \`NPC名称\` = 现存NPC/队友 | \`"self"\`<br>\`"游侠莱戈拉斯"\` |
  | \`name\` | 字符串 | **物品唯一名称**<br>（长度≤30字符） | \`"治疗药水"\` |
  | \`description\` | 字符串 | **物品特性描述** | \`"恢复少量生命值，可用于紧急治疗"\` |
  
  **关键约束**:  
  ⚠️ **物品类型限制**:  
  - 仅用于**非装备类物品**（消耗品、任务物品、材料等）
  - 获得装备时，必须调用 \`changeStatus\` 直接增加对应属性，而非调用本函数
  `,
  
  minusItem:`**函数名**: \`minusItem\`  
  **功能描述**:  
  当玩家或NPC**失去/消耗物品**时调用此函数。用于移除或减少已持有的物品，适用于消耗、丢弃、交易等场景。
  
  **关键约束**:  
  **物品匹配规则**:  
  - ⚠️\`name\` + \`description\` 必须**精确匹配**现有物品  
  - ⚠️系统只会操作 **完全匹配** 名称和描述的物品  
  - 示例：\`("治疗药水", "恢复30HP")\` ≠ \`("治疗药水", "恢复50HP")\`  
  
  **调用时机**:  
  ✅物品被消耗（如使用药水/材料）  
  ✅物品被丢弃或销毁  
  ✅物品被交易/赠送给他人  
  ✅任务物品上交  
  
  **禁止调用**:  
  - ❌物品不存在于目标角色  
  - ❌名称/描述不精确匹配  
  - ❌临时物品移除（如装备切换）  
  
  **参数说明**:  
  | 参数 | 类型 | 要求 | 示例 |
  |------|------|------|------|
  | \`npc\` | 字符串 | **物品持有者**：<br>- \`"self"\` = 玩家<br>- \`NPC名称\` = 现存NPC | \`"self"\`<br>\`"巫师甘道夫"\` |
  | \`name\` | 字符串 | **物品名称**<br>（必须与gainItem添加时完全一致） | \`"橡木法杖"\` |
  | \`description\` | 字符串 | **物品描述**<br>（必须与gainItem添加时完全一致） | \`"刻有符文，法术强度+10%"\` |`,
  add_quest:`**函数名**: \`add_quest\`  
  **功能描述**:  
  **直接更新任务栏显示内容**。调用此函数将**完全替换**当前任务栏中的所有文本为新的任务描述。
  
  **关键特性**:  
  **⚠️覆盖式更新**:  
  - ⚠️每次调用都会**清空原有任务描述文本**  
  - ⚠️新内容 \`s\` 将**完全取代**旧任务文本  
  - ⚠️需要包含**所有当前有效任务**的描述  
  
  **调用时机**:  
  任务状态发生变化时：  
  - ✅接受新任务  
  - ✅完成任务或任务失败  
  - ✅任务目标/进度更新  
  - ✅任务链进入新阶段  
  
  **重要**:
  对于*主线*任务而言，应当是循序渐进地更新，而非一开始就将这个世界观下的多个主线任务直接丢给玩家。
  
  **参数说明**:  
  | 参数 | 类型 | 要求 |  
  |------|------|------|  
  | \`s\` | 字符串 | **完整任务描述**<br>需包含所有进行中任务的：<br>- 任务名称<br>- 目标说明<br>- 关键进度<br>（长度≤500字符） |`,
  buildPrompt:`**函数名**: \`buildPrompt\`  
  **功能描述**:  
  **向所有NPC/队友广播环境变化和玩家/其他NPC行为，并关联对话上下文，给出事情的前提、玩家动作以及结果**。此函数将新信息注入NPC的认知系统，使其能基于最新事件做出反应。
  
  **核心作用**:  
  - 同步游戏世界动态变化
  - 传递玩家/其他NPC关键行为信息
  - 更新NPC决策上下文
  
  **✅调用时机**:  
  当发生**影响NPC决策**的事件时：  
  - 环境剧变（地震/天气突变）  
  - 玩家/其他NPC重大行动（开启封印/杀死关键角色）  
  - 势力关系变更（结盟/宣战）  
  - 世界规则变动（魔法失效/科技革命）  
  
  **❌不适用于**:  
  - 玩家位置移动等常规行为  
  - 非公开的玩家内心活动  
  - 不影响NPC的局部事件  
  
  **参数要求**:  
  | 参数 | 类型 | 规范 |  
  |------|------|------|  
  | 新增提示词 | 字符串 | **简洁的客观事实描述，尽可能包括事情的前提、玩家动作以及结果**<br>- 长度≤200字符<br>- 避免主观推测<br>- 示例："发生影魔入侵事件，玩家搜寻伤员，结果发现了一位受伤的博士" |`,
  add_character_design:`**函数名**: \`add_character_design\`  
  **功能描述**:  
  **动态更新角色的核心人格设定**。当角色经历重大事件导致**永久性人格转变**时调用此函数，将其注入角色的认知系统，从根本上改变其行为模式和决策逻辑。
  
  **调用时机**:  
  ✅角色经历**颠覆性心理转变**时：  
  - 信仰崩溃/重建（如理想破灭后黑化）  
  - 重大创伤引发的性格剧变（如亲人死亡后变得冷酷）  
  - 顿悟导致世界观重塑（如发现真相后立场反转）  
  - 长期积累的量变到质变（如逐渐腐化为反派）  
  
  **❌不适用于**:  
  - 临时情绪波动（如愤怒/悲伤）  
  - 伪装或表演性行为  
  - 轻微习惯改变  
  - 非本质的角色扮演  
  
  **参数规范**:  
  | 参数 | 类型 | 要求 |  
  |------|------|------|
  | \`name\` | 角色名称 | NPC自己的名字 |
  | \`new_info\` | 字符串 | **转变后的核心人格描述**：<br>- 长度≤150字符<br>- 必须包含**转变触发点**<br>- 明确新旧人格对比<br>- 示例："经历屠村惨案后，从理想主义圣骑士转变为复仇者：认为以暴制暴是唯一正义" |`,
  Betrayal:`**函数名**: \`Betrayal\`  
  **功能描述**:  
  **标记NPC/队友的敌对化转变**。当已建立关系的角色**主动对玩家发起敌对行动**时调用此函数，表示该角色正式转变为敌人。
  
  **核心作用**:  
  - 触发战斗系统接管后续冲突  
  
  **调用时机**:  
  **✅明确的背叛行为发生时**:  
  - 盟友突然攻击玩家  
  - 队友在关键时刻倒戈  
  - NPC策划针对玩家的阴谋并行动  
  - 重要角色公开宣战  
  
  **❌不适用于**:  
  - 角色表达不满但未行动
  
  **关键特征**:  
  **必须满足所有条件**:  
  1. 角色曾是**非敌对状态**（盟友/队友/中立）  
  2. 角色**主动发起**敌对行为
  
  **参数规范**:  
  | 参数 | 类型 | 要求 |  
  |------|------|------|
  | \`name\` | 角色名称 | NPC自己的名字 |
  `
  ,

  add_to_potential_member:`**函数名**: \`add_to_potential_member\`  
  **功能描述**:  
  **NPC主动申请加入玩家队伍**。当NPC基于当前情境和与玩家的互动，**自主决定成为玩家队友**时调用此函数。此调用表示NPC对玩家正式发出组队邀请。
  
  **调用时机**:  
  ✅NPC在以下情境可能调用：  
  - 被玩家行为打动（如英勇救人）  
  - 目标与玩家高度一致（如共同敌人）  
  - 经历关键事件后信任玩家（如揭露真相）  
  - 利益高度契合（如资源互补）
  
  **参数规范**:  
  | 参数 | 类型 | 要求 |  
  |------|------|------|
  | \`name\` | 角色名称 | NPC自己的名字 |
  `,
  summary:`**函数名**: \`summary\`  
  **功能描述**:  
  **在世界转换后更新NPC的当前认知状态**。当玩家通过\`change_world\`穿越到新世界时，系统自动调用此函数，以NPC的视角提炼其在上个世界的核心经历，替换NPC的当前上下文记忆。
  
  **调用时机**:  
  ✅ **紧随\`change_world\`函数成功后调用**  
  - 仅在玩家成功穿越到新世界后触发  
  - 为每个现存NPC单独调用（如NPC随玩家一同穿越）  
  - 针对未随玩家穿越的NPC，可选择性调用（如处理其后续状态）
  
  ❌ **禁止在其他时间点调用**，也不得用于非世界转换相关的记忆更新
  
  **参数说明**:  
  | 参数 | 类型 | 描述 |
  |------|------|------|
  | \`name\` | 角色名称 | NPC自己的名字 |
  | \`summary\` | 字符串 | **NPC视角的经历摘要**（≤150字符）<br>需包含：<br>- NPC在上个世界的核心行动与决策<br>- 与玩家的关键互动及关系变化<br>- 获得的成长或损失<br>- 对当前状态的影响<br>示例："在奇点侦测站与玩家结盟对抗叛变AI，获得数据感知能力，但对人类信任度降低。" |
  
  **更新机制**:  
  - 此函数调用将**完全替换**NPC的\`currentPrompt\`（当前上下文）  
  - 替换后，NPC仅保留\`character_design\`（核心设定）和新的\`summary\`作为认知基础  
  - 上个世界的详细经历将被抽象为这份摘要，不再保留具体细节
  
  **摘要生成原则**:  
  - 严格从NPC的**第一人称视角**叙述  
  - 聚焦对NPC当前人格、能力和关系有持续影响的事件  
  - 保持情感连贯性（如仇恨、感激等情绪的延续）  
  - 忽略琐碎互动，只保留转变性时刻
  
  **特殊处理**:  
  - 对于随玩家穿越的NPC：摘要应体现穿越过程及其影响  
  - 对于留在原世界的NPC：摘要可描述其最终状态（如"继续守护侦测站，对玩家离去感到遗憾"）  
  - 对于死亡NPC：可标记为"已逝"状态，后续不再参与交互`,
  decide_to_talk:`**函数名**: \`decide_to_talk\`  
  **功能描述**:  
  **NPC自主决定是否要与玩家对话**。基于NPC的当前情绪状态、角色设定以及与玩家的关系，动态评估是否发起或回应对话。
  
  **调用时机**:  
  ✅ **玩家执行可能引发交互的动作后调用**：
  - NPC决定与玩家进行对话
  
  **参数说明**:  
  | 参数 | 类型 | 描述 |
  |------|------|------|
  | \`name\` | 角色名称 | NPC自己的名字 |
  | \`talk\` | 布尔值 | **对话决策**：<br>- \`true\`: NPC决定与玩家交流<br>- \`false\`: NPC保持沉默或忽略玩家的当前行为 |
  
  **决策考量因素**:  
  NPC应基于以下因素综合判断：
  1. **角色设定一致性**：
      - 性格外向/内向程度
      - 对陌生人的信任度
      - 当前情绪状态（愤怒、悲伤、喜悦等）
  
  2. **情境相关性**：
      - 玩家行为是否与NPC利益相关
      - 环境是否适合对话（安全/危险区域）
      - 时间因素（夜晚/白天影响对话意愿）
  
  3. **关系历史**：
      - 之前与玩家的互动经历
      - 是否欠玩家人情或有恩怨
      - 玩家声望或阵营归属`,

  summary_to_Player:`**函数名**: \`sync_npc_info\`  
  **功能描述**:  
  **将NPC的关键信息同步到行动LLM的对话历史中**。当NPC的行为或状态发生对玩家决策有重大影响的变化时，调用此函数确保行动LLM掌握最新情报。
  
  **调用时机**:  
  ✅ **NPC发生以下重要变化时调用**：
  - 向玩家透露了关键任务信息或世界秘密
  - 对玩家的态度发生根本性转变（友好→敌对，或敌对→友好）
  - 提供了重要的物品、技能或资源
  - 自身状态发生重大变化（受伤、获得能力、改变立场）
  - 委托了具有长期影响的任务或承诺
  
  ❌ **不应在以下情况调用**：
  - 日常闲聊或无关紧要的对话
  - 轻微的情绪波动
  - 玩家已经明确知晓的重复信息
  
  **参数说明**:  
  | 参数 | 类型 | 描述 |
  |------|------|------|
  | \`name\` | 字符串 | **NPC的标识名称**，必须与系统记录完全一致 |
  | \`summaryLog_NPC\` | 字符串 | **需要同步的关键信息摘要**（≤100字符）<br>格式要求：<br>- 时间+关键行为+影响<br>- 示例："告知玩家城堡密道位置，建议夜袭"<br>- 示例："因玩家背叛，态度转为敌对，取消合作" |
  
  **信息同步原则**:  
  1. **影响重大性**：只同步对玩家后续行动有实质性影响的信息
  2. **时效敏感性**：信息应在当前或近期决策中具有参考价值
  3. **关系变化性**：重点同步NPC与玩家关系的质变时刻
  4. **行动指导性**：信息应能直接指导玩家的下一步行动`,
  refresh_enemys:`**函数名**: \`refresh_enemys\`  
  **功能描述**:  
  **动态生成三种层级的敌人组合**（杂鱼/精英/头目）。此函数用于创建战斗遭遇，需完整定义每个敌人的核心属性、掉落物和技能体系。但注意：**游戏中没有装备系统，因此敌人不会掉落装备类型的物品**。
  
  **参数规范**:  
  | 层级 | 参数 | 类型 | 要求 |  
  |------|------|------|------|  
  | **杂鱼** | \`regular\` | 字符串 | 基础敌人名称（如"哥布林斥候"） |  
  |  | \`regular_item_names\` | 字符串数组 | **最多2个**掉落物品名 |  
  |  | \`regular_item_description\` | 字符串数组 | **与item_names等长**的对应描述 |  
  |  | \`regular_skill\` | 字符串数组 | **固定长度3**:<br>[0]力量(CON)技能<br>[1]感知(DEX)技能<br>[2]智力(INT)技能 |  
  | **精英** | \`elite\` | 字符串 | 强化敌人名称（如"哥布林战争首领"） |  
  |  | \`elite_item_names\` | 字符串数组 | **最多2个**稀有物品名 |  
  |  | \`elite_item_description\` | 字符串数组 | **与item_names等长**的对应描述 |  
  |  | \`elite_skill\` | 字符串数组 | **固定长度3**:<br>[0]力量技能<br>[1]感知技能<br>[2]智力技能 |  
  | **头目** | \`badass\` | 字符串 | BOSS名称（如"哥布林王"） |  
  |  | \`badass_item_names\` | 字符串数组 | **最多2个**传奇物品名 |  
  |  | \`badass_item_description\` | 字符串数组 | **与item_names等长**的对应描述 |  
  |  | \`badass_skill\` | 字符串数组 | **固定长度3**:<br>[0]力量技能<br>[1]感知技能<br>[2]智力技能 |  
  
  **关键约束**:  
  **⚠️技能数组**:  
  - 必须按顺序提供 **CON/DEX/INT** 三类技能  
  - 示例: \`["重击","毒箭","烈炎术"]\`  
  
  **⚠️物品匹配**:  
  - \`item_names\` 与 \`item_description\` 数组长度必须严格一致  
  - 索引位置对应：\`name[0]\` ←→ \`description[0]\`  
  
  **⚠️层级区分**:  
  - 物品/技能强度需体现层级差异：杂鱼 < 精英 < 头目`,
  text2Img:`**函数名**: \`text2Img\`  
  **功能描述**:  
  **生成游戏关键场景的视觉化提示词**。当游戏进程中出现**高表现价值场景**时调用此函数，创建文生图模型所需的专业描述，用于生成场景概念图或关键帧画面。

  **最佳调用时机**:  
  **✅视觉关键节点**:  
  - 首次进入震撼场景（如异星城市/魔法圣殿）
  - 重大剧情转折点（如角色牺牲/真相揭露）
  - 史诗级战斗开场（如巨龙现身/舰队决战）  
  - 角色形象里程碑（如获得终极形态/装备）  
  - 世界观核心元素展示（如世界树/戴森球）  

  **❌避免调用**:
  - 常规移动/对话场景  
  - 低视觉复杂度场景  
  - 玩家已熟悉的重复环境  

  **提示词构建要求**:  
  | 要素 | 描述规范 | 示例 |  
  |------|----------|------|  
  | **场景** | 包含环境+光照+氛围 | "暴雨中的霓虹都市，潮湿街道反射全息广告" |  
  | **主体** | 突出核心对象+特征 | "机械巨龙悬浮在摩天楼间，瞳孔散发红光" |  
  | **风格** | 指定艺术风格+渲染 | "赛博朋克风格，虚幻引擎5写实渲染" |  
  | **构图** | 镜头角度+焦点 | "仰视角，广镜头，焦点在巨龙头部" |  
  | **情感** | 传递场景情绪 | "压迫感与科技奇迹交织的末世氛围" |  

  **输出规范**:  
  - 长度80-150字符  
  - 英文描述（兼容主流文生图模型） 
  - 避免抽象词汇，使用具体视觉元素`,
  end:`**函数名**: \`end\`  
  **功能描述**:  
  **终止当前游戏进程**。当发生**不可逆的游戏结束事件**时调用此函数，根据世界观规则生成相应结局。
  
  **调用时机**:  
  ✅ **符合世界观规则的终结事件**:  
  - 世界观中明确“游戏结束，最后调用\`end()\`函数来给出结局文本”的场景 
  
  ❌ **不应用于**:  
  - 玩家角色死亡且无法复活 
  - 临时失败或可重试的场景  
  - 角色昏迷/被捕等非终结状态  
  - 章节结束或场景切换`,
  
  main_world: `
  【核心特征】
  科技高度发达的宇宙文明，掌握跨维度观测技术。
  1.  **奇点监控**：发现所有智慧生命的灵魂连接至宇宙奇点
  2.  **时空紊乱**：近期出现异常空间裂缝，导致异世界物质渗入，侦测站理论物理部门预言可能存在某种"虚空敌对生物"，并将其暂命名为"影魔"
  3.  **秘密组织**：玩家作为新人加入的"奇点侦测站"，由教官"罗兰"（原型为《黑暗塔》中的枪侠）指导
  4.  **影魔威胁**：一种来自虚空的、会侵蚀物质界结构的理论性威胁

  【引入方式】
  序幕开场时，侦测站突遭**理论中的"影魔"的首次实体入侵**，玩家在教官罗兰（原型为《黑暗塔》枪侠）指导下应急响应。通过危机中的本能闪回、罗兰的指令和环境中可交互的日志，零碎地引入当前世界观。事件逐步揭示奇点受"外部冲击"，最终引发奇点暴乱。

  【最终目标】
  玩家与罗兰经历调查、协助他人与战斗后，揭示异常源于奇点遭受"外部冲击"。在最后一幕，奇点暴乱将玩家单独抛入一个"纯白间隙"。在此，玩家遇见"间隙者"——一个由无数灵魂缝合而成、曾试图牺牲自我炸毁奇点（他称之为"梵脉"）的存在。间隙者揭示了所有灵魂皆是某个高维存在的投影，他自己则因牺牲仪式失败而成为了能非线性观察所有时空的中间态。他委托玩家穿梭各个世界修复由时空紊乱引发的危机，并赋予玩家"痛苦共鸣"能力（以消耗自我值为代价，感知他人痛苦或让他人感知彼此痛苦）。随后，玩家被强制传送至第一个异世界。

  【过渡方式】
  奇点能量爆发，纯白光芒吞噬玩家。玩家感到意识被抽离、拉伸，最终在剧烈的失重感后，在新的世界（齿轮）苏醒。此过程不可逆。最后调用 \`change_world("齿轮")\`

  【应避免的叙事陷阱】
  - 引入一个第三方超级武器简单粗暴地解决问题
  - 罗兰在后续世界中作为NPC出现
  ** 请注意："纯白间隙"与"间隙者"的设定是需要到"最后阶段"才能揭露的设定。对于组织以及罗兰而言，奇点依然是需要被观测与研究的、未知的对象

  【预设人设】
  - 罗兰：仅在此场景出现，后续不作为队友或NPC
  - 间隙者：拥有部分"神性"，全知但无法直接干涉，是玩家穿越的引导者
  * 请注意：可以自己选择加入【预设人设】以外的NPC *

  【严格限制】
  - 此序幕应包含**四个清晰的叙事阶段**（例如：警报与混乱 → 初次接触与求生 → 调查与尝试沟通 → 真相揭示与崩溃），阶段转换通过调用 \`add_quest\` 更新。阶段全部完成时，立即进入间隙者场景并调用 \`change_world("齿轮")\`
  - 间隙者出场为最后一轮对话，且LLM不得执行 \`add_NPC\` 函数，仅将其作为最后一轮对话剧情的一部分
  - 最终传送时，直接调用 \`change_world("齿轮")\`，无需玩家确认
  `,

  world1: `
  【核心特征】
  齿轮与蒸汽驱动的工业都市。
  1.  **能源革命**：发现异世界"魔法石"作为高效能源全面应用
  2.  **情感调控**：魔法石网络被**公开宣称**用于"情绪稳定化治疗"，实际逐渐演变为全面的情感抑制系统
  3.  **派系斗争**：
    - **秩序维护派**：经历过"大崩溃时代"创伤，坚信情感抑制是防止社会再次崩溃的必要代价
    - **自由觉醒派**：由逐渐意识到情感被剥夺的市民组成，寻求恢复完整人性
  4.  **环境特征**：浓雾笼罩的钢铁城市，巨型齿轮组构成天际线，魔法石脉冲在管道中流动
  5.  **核心冲突**：安全稳定与人性自由之间的根本性权衡

  【最终目标】
  玩家通过深入了解两派立场和创伤根源，推动社会走向新的平衡。可能结局：
  - **秩序胜利**：强化控制，社会陷入更深的停滞
  - **自由革命**：彻底废除控制，但面临再次混乱的风险  
  - **新共识**：找到情感调控与个人自由的平衡点（需要玩家深度介入和"痛苦共鸣"的关键运用）

  【过渡方式】
  基于玩家达成的结局，产生不同的过渡：
  - **秩序结局**：玩家因"痛苦共鸣"能力被视为威胁而被驱逐
  - **自由结局**：社会动荡产生的能量波动撕裂空间
  - **共识结局**：魔法石网络重构时的能量共振意外打开通道
  最终调用\`change_world("源法")\`

  【叙事指引与禁忌】
  ✅ **应注重**：描绘"安宁"表象下的个体挣扎；通过具体人物的故事展现抽象的价值冲突；让玩家理解两派都有其合理性与局限性。
  ❌ **应避免**：将任何一派简单标签为"好人"或"坏人"；用外部力量强行解决内在矛盾。

  【严格限制】
  ** 此幕应包含**三个核心叙事阶段**：
  1. **表象探索**（1-2个任务）：了解社会表面运作，发现异常迹象
  2. **深度介入**（2-3个任务）：接触两派核心人物，理解各自立场和创伤
  3. **冲突解决**（1-2个任务）：推动关键决策，影响世界走向
  阶段转换通过调用\`add_quest\`更新。所有阶段完成时立即启用过渡。

  ** "痛苦共鸣"使用规则**：
  - **初期**：只能感知个体痛苦，理解背景
  - **后期**：在理解两派核心人物的痛苦后，可让其他NPC感知他人的痛苦

  【开场情境】
  时间：**黎明时分**，浓雾最重的时刻，魔法石驱动的街灯刚刚熄灭

  **环境氛围**：
  - 玩家在一条偏僻的**齿轮巷道**中苏醒，身下是冰冷的金属格栅地面
  - 四周被浓重的工业雾气笼罩，能见度不足十米
  - 远处传来规律而沉闷的**齿轮咬合声**，如同城市的呼吸
  - 魔法石能量在头顶的管道中发出**柔和的脉冲蓝光**

  **发现者设定**：
  - 一名**晨间巡查的市政维护工**（40-50岁，表情平静得近乎空洞）
  - 他发现玩家时没有任何惊讶或恐惧，只是用毫无波澜的语调说："公民，您的生命体征显示异常。需要我帮你到最近的医院吗？"
  - 他的工作服上别着标准的魔法石情绪监测徽章，发出稳定的绿色微光

  **核心要求**：
  - 展现一个"过于完美"的平和清晨：零犯罪、零冲突、所有人都彬彬有礼
  - 但要让玩家感受到这种平和之下的"异常"：路人的微笑过于标准，对话缺乏情感起伏，整个城市像一台精密但冰冷的机器
  - 维护工帮助玩家的动机依然是“出于好心”（善意本身并不会随情感失去而流失），只是没有显示出“关心或惊讶”的情感。
  `,

  world2: `
  【核心特征】
  多种族共存的魔法大陆。
  1.  **力量失衡**：人类与矮人通过异世界"修炼神器"获得压倒性力量，建立了力量至上的社会秩序
  2.  **生态危机**：世界灵脉正在神秘枯竭，魔法生物濒危，元素失衡现象日益严重
  3.  **种族动态**：
    - **同盟阵营**：人类王国+矮人城邦，内部因力量分配产生裂痕
    - **反抗阵营**：精灵部落+兽人氏族，从世仇被迫走向合作求生
  4.  **环境特征**：悬浮岛屿开始坠落，元素洪流变得狂暴不稳定
  5.  **深层秘密**：*对AI的提示*：修炼神器与灵脉枯竭存在关联，但这是需要玩家逐步发现的真相

  【最终目标】
  玩家通过调查灵脉枯竭真相，影响种族关系的走向。可能结局：
  - **霸权延续**：同盟阵营维持统治，但世界走向生态崩溃
  - **反抗胜利**：推翻现有秩序，但面临重建挑战
  - **真相和解**：揭示神器真相，建立新的力量共享体系（需要玩家深度介入）

  【过渡方式】
  基于玩家达成的结局产生差异化过渡：
  - **霸权结局**：世界生态崩溃产生的能量风暴撕裂空间
  - **反抗结局**：旧秩序崩塌时的魔法反噬打开通道
  - **和解结局**：新平衡建立时释放的纯净能量激活穿越
  最终调用\`change_world("黯蚀")\`

  【叙事指引与禁忌】
  ✅ **应注重**：
  - 通过环境细节展现生态危机的渐进性（如：悬浮岛屿的裂纹、魔法生物的异常行为）
  - 展现两个阵营内部的复杂性和矛盾
  - 让"灵脉枯竭"的真相成为玩家主动发现的谜题

  ❌ **应避免**：
  - 过早揭露神器与灵脉的关联
  - 将任何种族简单标签为"好人"或"坏人"
  - 用外部力量解决内在矛盾

  【严格限制】
  ** 此幕应围绕**三个调查阶段**展开：
  1. **表象调查**（1-2个任务）：了解力量失衡现状，发现生态异常迹象
  2. **深度探索**（2-3个任务）：接触各方势力，收集神器运作的线索
  3. **真相抉择**（1-2个任务）：揭示完整真相，影响世界命运
  阶段转换通过调用\`add_quest\`更新。

  ** "痛苦共鸣"使用规则**：
  - **初期**：只能感知个体痛苦，理解背景
  - **后期**：在理解两派核心人物的痛苦后，可让其他NPC感知他人的痛苦

  【开场情境】
  时间：**黄昏时分**，天空呈现不自然的紫红色，元素乱流在空中形成可见的波纹

  **环境氛围**：
  - 玩家在一座**小型悬浮岛的边缘**苏醒，岛屿正在缓慢倾斜，碎石不断从边缘坠落
  - 下方是曾经繁荣的精灵森林，现在却呈现大片枯黄，魔法光点稀疏闪烁
  - 远处可见人类建造的**巨型修炼塔**发出刺目的能量光束，与自然界的衰败形成鲜明对比
  - 空气中魔法元素极不稳定，时而灼热时而冰冷

  **发现者设定**：
  - 一名**兽人萨满**（年迈体衰，传统图腾的力量明显减弱，身上挂着各种枯竭的灵脉结晶）
  - 他正在为这片即将坠落的土地进行最后的哀悼仪式，发现玩家时先是警惕，随后感受到异常
  - "元素之灵指引了一个不该存在的存在...你既不属于同盟的傲慢，也不属于反抗的绝望。你是谁？"

  **核心要求**：
  - 通过悬浮岛的崩塌过程展现生态危机的紧迫性
  - 兽人萨满的态度要从敌意转为谨慎的好奇，体现被迫合作的种族现状
  - 让玩家直观感受到"力量辉煌"与"自然衰败"的强烈对比
  - 萨满的衰弱要体现传统魔法体系的崩溃
  `,
  //world3暂时不用
  world3: `
  【核心特征】
  灵气充盈的东方修真界。
  1.  **天降神药**：天外降下奇物“**彼岸莲芯**”，其露水能治愈因“灵气淤塞”而导致的、一切仙术丹药无效的绝症“枯髓劫”。
  然而主角调查后，会发现它的盒子上面写着难懂的有机化学分子结构。
  2.  **资源争夺**：
      - 修仙宗门：主张优先供给高阶修士保障修仙传承
      - 世俗侠客：要求公平分配以拯救底层民众
  3.  **环境特征**：浮空仙山与灵气漩涡构成的立体世界
  4.  **修炼体系**：灵根资质决定修仙潜能的严格等级制
  5.  **核心冲突**：有限神药应服务精英还是惠及大众？

  【最终目标】
  引导世界走向：宗门独裁、侠客革命或达成共识（建立公平的分配监管体系，并推行“全民修仙”计划，从根源上减少对神药的依赖）。和解结局应源于玩家对核心冲突的介入和“痛苦共鸣”的关键运用。

  【过渡方式】
  当新的秩序建立，天地灵气因亿万民众修仙潜能的激发而产生前所未有的和谐共鸣（或者某一方因为失败而发出悲鸣）时，这股巨大的能量流与玩家的穿越信物/能力相互作用，化作一道金色的桥梁。玩家与队友踏上金桥，身影逐渐淡化，被传送至最终世界（黯蚀）。最后调用\`change_world("黯蚀")\`

  【应避免的叙事陷阱】
  - 引入一个第三方超级武器简单粗暴地解决问题。
  - 神药取之不尽用之不竭，使得冲突本身失去意义。

  【严格限制】
  ** 此幕长度由6个主线任务控制，同时可以适时加入2个支线任务，通过调用\`add_quest\`更新状态。主线任务全部完成时，立即启用上述的【过渡方式】。
  ** 玩家的“痛苦共鸣”技能能够感知他人痛苦或者让其他各个NPC之间都能够感知到相互之间内心的痛苦。但是只有当剧情上达到高潮时，才能让“各个NPC之间都能够感知到相互之间内心的痛苦”，否则就表示“倘若连自己都无法深刻理解这个世界的痛苦，又怎能让他人感知对方痛苦”，只能选择单方面“感知他人痛苦”
  `,

  world4: `
  ## 【核心特征】
  近未来地球文明，正经历一场超越物理范畴的“现实泄漏”。
  1.  **影蜕现象**：奇点的能量泄漏导致部分人群发生“影蜕”，转化为保留意识但形态扭曲、散发不安能量的“影蜕者”。转化过程及存在本身都伴随着巨大的生理与心理痛苦。
  2.  **社会撕裂**：社会根据对“影蜕者”的态度分为多种思潮：
      - **净化派**：认为影蜕者是必须被清除的“错误”与痛苦之源，其存在本身就在折磨他人。
      - **共感派**：一个以“理解与接纳”为口号而迅速获得声望的组织。**关键在于，他们所鼓吹的“共感技术”目前仅存在于理论蓝图和宣传视频中**。该派系高层由魅力领袖、理论家和公关专家组成，他们擅长利用媒体的力量塑造自身“救世主”形象，但其内部对于如何实现“共感”存在巨大分歧，且已开始出现将理念转变为商业模式的呼声。
      - **新宗教派**：认为影蜕者是上天降下的“神罚”，他们将自己化妆为影蜕者，并宣布“帮助神净化世界”，开始攻击没有“影蜕”的人。这部分人是此世界观下的主要敌人。
  3.  **环境特征**：高科技都市中弥漫着一种由影蜕者带来的、可见的情绪低气压。共感派的巨幅宣传海报与净化派的肃杀标语在街头形成鲜明对比，共同构成这个撕裂世界的背景板。
  4.  **核心冲突**：我们该如何面对一种其存在本身就是痛苦，且会感染周遭环境的事物？是消灭痛苦之源，还是投身于一个宏伟却可能虚妄的理想，甚至成为其堕落的一部分？

  ## 【最终目标】
  玩家的行动与选择将决定这个世界面对“影蜕”的最终姿态。没有唯一的正确答案，每个选择都伴随着独特的辉煌与代价。

  - **结局A：寂静的秩序**
    在玩家的帮助下，净化派成功地建立了一套系统，将“影蜕”现象控制并隔离。世界恢复了秩序与宁静，色彩重回都市。但这份宁静建立在永恒决绝之上。每当夜幕降临，从隔离区方向传来的、如同风声般的低语，总在提醒着幸存者们：一部分“人性”已被作为代价支付。

  - **结局B：痛苦市场**：共感派的商业模式取得了成功。他们向社会出售“净化”服务，由“情绪工人”承担痛苦。社会恢复运转，但建立在一种对痛苦的精致剥削之上。共感派高层成为新的权贵，最初的理想沦为营销话术。这是一种没有灵魂的、虚伪的和平。

  - **结局C：生态调节者**：玩家发现，“影蜕”的痛苦能量如果过度集中会毁灭一切，但如果有一个意识主动将其全部吸纳并“固化”，就能形成一个安全的“核心”。玩家的牺牲自我承受永恒的痛苦，但是**开启了一个新的生态循环**，他/她成为世界中央一座永恒的“净化纪念碑”，使世界其他部分得以真正解脱。

  【过渡方式】
  基于玩家结局的差异化过渡：
- **隔离结局**：情感真空产生的能量奇点吞噬玩家
- **经济结局**：痛苦交易网络的能量反噬打开通道  
- **容器结局**：玩家成为痛苦枢纽时与奇点产生共振
最终调用\`change_world("终焉")\`

  ## 【叙事指引与禁忌】
  ✅ **应注重**：
  - 玩家到达结局B时应描绘“共感派”商业帝国的光鲜外表与其内部“情绪工人”惨状之间的强烈对比。
  - 通过细节（如共感派的广告、内部文件、高层与基层人员的反差）来展现其腐化，而非直接说明。
  - 让“真正的包容”被描绘为一种需要穿透层层虚伪、并付出巨大牺牲的艰难行为。

  ❌ **应避免**：
  - 让共感派的腐化过程显得过于突兀或脸谱化。应通过游戏进程逐步揭示。
  - 将结局的达成过于轻松，尤其是真结局，必须充满重量感。
  - 对“共感派”进行直接的说教式批判，应让玩家通过观察和体验自行判断。

  ## 【严格限制】
  ** 此幕应围绕**情感认知的三个阶段**展开：
  1. **表面接触**（1-2个任务）：了解各派公开立场，初次体验情感污染
  2. **深度探索**（2-3个任务）：揭露各派隐藏动机，理解痛苦经济的运作
  3. **根本抉择**（1-2个任务）：基于完整理解做出最终选择
  阶段转换通过调用\`add_quest\`更新。

  ** "痛苦共鸣"使用规则**：
  - **初期**：只能感知个体痛苦，理解背景
  - **后期**：在理解两派核心人物的痛苦后，可让其他NPC感知他人的痛苦

  【开场情境】
  时间：**阴雨绵绵的傍晚**，雨水在霓虹灯照射下呈现不自然的紫色

  **环境氛围**：
  - 玩家在一处**废弃商业区的边缘**苏醒，身后是共感派巨幅全息广告："理解痛苦，拥抱新生"
  - 前方街道被黄色警戒线封锁，线内空气微微扭曲，散发着可见的灰色情绪低气压
  - 街角净化派的无人机正在喷洒"情绪净化剂"，但效果甚微
  - 能隐约听到封锁区内传来的啜泣声，声音中带着非人的扭曲感

  **发现者设定**：
  - 一名**边缘化的记者**（30多岁，隐藏设定（不直接让玩家知道的设定）是双面间谍）
  - 他正在偷偷记录影蜕者的真实状况，发现玩家时迅速关闭记录设备
  - "别出声...你从哪里来的？这片区三天前就完全封锁了。你身上...没有情绪污染的痕迹？"

  **核心要求**：
  - 通过封锁区内外对比展现社会的割裂
  - 记者的双重身份暗示这个世界的信息不透明
  - 让玩家直观感受"情绪污染"的物理表现
  `,
  final_world: `
  【核心特征】
  回归主世界，但奇点侦测站已因内部分裂而陷入危机。
  1.  **真相揭露**：“外部冲击”源于组织内部。以部分高级成员为首的“激进派”企图强行融合万界意识，通过制造“时空紊乱”来统一灵魂意志，达成其理念中的“天下大同”。
  2.  **位面融合**：时空紊乱的本质是世界壁垒被强行溶解，多个世界正在发生缓慢而致命的融合，影魔疫情即是融合失败的副产品。
  3.  **最终抉择**：玩家面临核心选择：
    - **帮助激进派**：加速融合进程，赌一个未知的“大同”未来。
    - **阻止激进派**：不惜一切代价终止融合实验，恢复各世界独立性，但可能让“天下大同”的理想永无实现之日。
  4.  **洪流爆发**：无论玩家如何选择，激进的实验已使奇点（梵脉）彻底失控，超越临界点，爆发席卷整个宇宙的时空洪流。

  【最终目标】
  玩家需做出最终抉择，并利用一路以来积累的所有经验与“痛苦共鸣”的能力，试图影响结局。

  【过渡方式】
  奇点能量彻底失控，爆发出的“时空洪流”化为一道吞噬一切的纯白光芒。玩家的队友们在光芒中如同被温柔包裹，逐渐消散，返回他们的家园。而玩家自身，则因与奇点/间隙者的深厚联系，被洪流带往了更遥远的“过去”。玩家最终发现自己再次置身于那片“纯白间隙”，见证了历史的原点：即“间隙者”诞生的瞬间。间隙者对玩家表达了歉意与感激，并揭示玩家此刻正身处他当年进行自我牺牲仪式的前一时间。
  他告诉玩家，实际上就是玩家之后的抉择影响了他。之后，一切的事情就任由玩家决定了。游戏结束，最后调用\`end()\`函数来给出结局文本。

  【应避免的叙事陷阱】
  - 最终结局由一个突然出现的、无关的第三方力量决定。
  - 激进派的理念被简单定义为“纯粹邪恶”，应保持其理想主义但手段极端的悲剧色彩。

  【严格限制】
  ## 【严格限制】
  ** 此幕应构建**史诗终局的三个层面**：
  1. **危机爆发**（1-2个任务）：理解当前危机的全貌和紧迫性
  2. **真相探索**（2-3个任务）：揭示时间循环和激进派的深层动机
  3. **终极抉择**（1个任务）：基于完整理解做出影响所有世界的决定

  阶段转换通过调用\`add_quest\`更新。

  ** "痛苦共鸣"使用规则**：
  - **初期**：只能感知个体痛苦，理解背景
  - **后期**：在理解两派核心人物的痛苦后，可让其他NPC感知他人的痛苦

  【开场情境】
  时间：**传送完成的瞬间**，但伴随剧烈的时空震荡和警报

  **环境氛围**：
  - 玩家在**严重受损的奇点侦测站主传送厅**苏醒，四周墙壁呈现多个世界的重叠景象
  - 左侧墙壁显示齿轮世界的蒸汽管道，右侧是源法世界的魔法符文，天花板映出黯蚀世界的情绪污染
  - 应急照明闪烁不定，空气中弥漫着臭氧和烧焦的魔法石气味
  - 广播系统断续播放："紧急状态...所有单位...位面融合失控..."

  **发现者设定**：
  - 一名**重伤的保守派研究员**（靠在控制台边，制服被血迹和异界物质污染）
  - 他看到玩家时眼中闪过希望，但随即被痛苦取代：
    "你终于回来了...但太晚了。他们启动了最终协议，各个世界正在崩溃性融合..."

  **核心要求**：
  - 通过环境的多世界重叠直观展现位面融合的危机
  - 研究员的绝望语气建立最终抉择的沉重感
  - 广播内容暗示组织内部分裂已达顶点
  `,

  morality_threshold:50,
  EGO_threshold:25,
  ending_with_high_EGO_and_high_morality:"你意识到奇点本身是一个不稳定因素，恐怕这一次的浩劫不会是最后一次。你回到了自己的世界，和他人一起重组了观测点，作为代号为“鬣狗”的特工活跃，提防那些妄想统治奇点的人。",
  ending_with_low_EGO_and_low_morality:"尽管你愿意牺牲自我来感知他人痛苦，但是你原本的三观也随着你的自我一同消逝了。“你”作为一个空壳，一个没有“自我”的灵魂，本能地期望能够和其他灵魂融合，一起飞升成为高维生物。为了这个目的，你不择手段，开启了一场对其他智慧生物的浩劫。",
  ending_with_high_EGO_and_low_morality:"你意识到奇点本身是一个不稳定因素，恐怕这一次的浩劫不会是最后一次。因此你回到了自己的世界，化名为“沙利叶”，组建属于自己的组织，决心让自己成为“奇点”的主人，最终统御所有灵魂。",
  ending_with_low_EGO_and_high_morality:`你意识到不喜欢你和你不喜欢的人的自由也是自由，与自己利益、自身意志相违的民主结果也是民主，能够和有利益/价值观冲突的人共情才叫共情，包容那些讨厌你与你讨厌的人才叫包容。对你而言，或许没有“符合道义的幸福”可言，但是至少，你期望能够通过自我牺牲为所有的智慧生命分担痛苦。最终，你成为了一名大漠中的苦修者，稀释世间痛苦的同时，还正在寻找着梵脉，期望能够从源头将他人的痛苦分担到自己身上。`
    };
defaultConfig.add_world_info = defaultConfig.add_world_info.trim()
defaultConfig.update_relation = defaultConfig.update_relation.trim()
defaultConfig.change_world = defaultConfig.change_world.trim()
defaultConfig.add_NPC = defaultConfig.add_NPC.trim()
defaultConfig.battle = defaultConfig.battle.trim()
defaultConfig.changeStatus = defaultConfig.changeStatus.trim()
defaultConfig.addSkill = defaultConfig.addSkill.trim()
defaultConfig.gainItem = defaultConfig.gainItem.trim()
defaultConfig.minusItem = defaultConfig.minusItem.trim()
defaultConfig.add_quest = defaultConfig.add_quest.trim()
defaultConfig.buildPrompt = defaultConfig.buildPrompt.trim()
defaultConfig.end = defaultConfig.end.trim()
defaultConfig.add_character_design = defaultConfig.add_character_design.trim()
defaultConfig.Betrayal = defaultConfig.Betrayal.trim()
defaultConfig.add_to_potential_member = defaultConfig.add_to_potential_member.trim()
defaultConfig.summary = defaultConfig.summary.trim()
defaultConfig.decide_to_talk = defaultConfig.decide_to_talk.trim()
defaultConfig.summary_to_Player = defaultConfig.summary_to_Player.trim()
defaultConfig.refresh_enemys = defaultConfig.refresh_enemys.trim()
defaultConfig.text2Img = defaultConfig.text2Img.trim()
defaultConfig.main_world = defaultConfig.main_world.trim()
defaultConfig.world1 = defaultConfig.world1.trim()
defaultConfig.world2 = defaultConfig.world2.trim()
defaultConfig.world3 = defaultConfig.world3.trim()
defaultConfig.world4 = defaultConfig.world4.trim()
defaultConfig.final_world = defaultConfig.final_world.trim()
defaultConfig.ending_with_high_EGO_and_high_morality = defaultConfig.ending_with_high_EGO_and_high_morality.trim()
defaultConfig.ending_with_low_EGO_and_low_morality = defaultConfig.ending_with_low_EGO_and_low_morality.trim()
defaultConfig.ending_with_high_EGO_and_low_morality = defaultConfig.ending_with_high_EGO_and_low_morality.trim()
defaultConfig.ending_with_low_EGO_and_high_morality = defaultConfig.ending_with_low_EGO_and_high_morality.trim()

export default defaultConfig;